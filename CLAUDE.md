# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Important Documentation Files
- **Vision**: `docs/vision.md` - what to achive
- **Design**: `docs/design.md` - User stories, software structure and philosophy
- **Technical Requirements**: `docs/requirements.md` - Tech stack, data models, and security requirements

## Key Features Documentation
- **Permissions**: `docs/features_concepts/permissions.md` - Permission model and autonomous operation
- **O365 Authentication**: `docs/features_concepts/o365_authentication.md` - Microsoft 365 authentication and token caching

## Project Directory Structure

### Agent Working Folders
- **`_DATA_FROM_USER/`** - User-provided files (images, PDFs, documents)
- **`_SCRIPTS_FROM_AGENT/`** - Reusable scripts created by the agent
- **`_RESULTS_FROM_AGENT/`** - Output and results generated by the agent
- **`_DOWNLOADS_FROM_AGENT/`** - Files downloaded from web by the agent

### Documentation Folders
- **`docs/`** - All project documentation, architecture, and design files
- **`docs/features_concepts/`** - Feature-specific documentation

## Working with spec-kit
if the command /specify /plan or /task is used, have a look at files: README.md docs/vision.md docs/design.md docs/requirements.md you may find all the hints you need.

## for your coding practice, there are some important rules:
1. Start by analysing features and document the feature and update the documentation.
   Features get a name and the place to document them are here:
   `docs/features_concepts/<feature_name>.md`
2. implement tests 
3. implement the feature - carefully decide to create DRY modules. In doubt, read:
   file `CLAUDE_BBS.md` - do not over-engineer. BUT CREATE REUSABLE COMPONENTS. BBS style.
4. 
   You may read the current last log entries by something like:
   file server.log # that you may read with:
   `tail -n 300 server.log`
5. run all tests (with `uv run pytest` or even more intense `./check.sh`)
6. iterate on the feature until tests are running and user is satisfied
7. if feature is implemented: 
   update the docs

## Development Commands

```bash

./run-agent.sh # writes logs to stdio and to server.log

# Run all python tests
uv run pytest

# Run comprehensive quality checks (formatting, linting, type checking, tests)
./check.sh

# For debugging: claude will be able to read server logs
# in file server.log with command
tail -n 300 server.log

```



### Package Management
- Use `uv add <package>` to install new dependencies
- Use `uv sync` to sync dependencies
- Use `uv remove <package>` to remove packages
- **NEVER** use pip directly - always use uv

### Quality Assurance Pipeline
```bash
# Complete development pipeline (runs in this order):
./check.sh  # Executes:
1. uv run black .          # Code formatting
2. ruff check --fix .      # Linting with auto-fix
3. mypy .                 # Type checking
4. uv run pytest          # All tests
5. pytest                 # All tests, shorter

# Always run ./check.sh before committing changes
```

